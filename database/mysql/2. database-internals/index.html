<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <title>Database Internals &mdash; Software Engineering Notes</title>
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/tonsky/FiraCode@1.206/distr/fira_code.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/all.css">
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.8.1/css/v4-shims.css">
    <link rel="stylesheet" href="../../../css/theme.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
    <script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <script>
        hljs.initHighlightingOnLoad();
    </script> 
</head>

<body ontouchstart="">
    <div id="container">
        <aside>
            <div class="home">
                <div class="title">
                    <button class="hamburger"></button>
                    <a href="../../.." class="site-name"> Software Engineering Notes</a>
                </div>
                <div class="search">
                    <div role="search">
    <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
        <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
    </form>
</div>
                </div>
            </div>
            <nav class="nav">
                <ul class="root">
                    <li class="toctree-l1"><a class="nav-item" href="../../..">Home</a></li>
                    <li class="toctree-l1"><button class="section nav-item">Algorithms</button>
<ul class="subnav">
    <li class="toctree-l2"><a class="nav-item" href="../../../problem-solving/backtracking/">Backtracking</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../algorithms/data-structures/">Data Structures</a></li>
    <li class="toctree-l2">
<a class="nav-item" href="../../../algorithms/dynamic-programming.md">Dynamic Programming</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../algorithms/graph/">Graphs</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../problem-solving/greedy/">Greedy</a></li>
    <li class="toctree-l2">
<a class="nav-item" href="../../../algorithms/math.md">Math</a></li>
    <li class="toctree-l2">
<a class="nav-item" href="../../../algorithms/searching.md">Searching</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../algorithms/sorting/">Sorting</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../algorithms/string/">Strings</a></li>
</ul></li>
                    <li class="toctree-l1"><button class="section nav-item">C++</button>
<ul class="subnav">
    <li class="toctree-l2"><a class="nav-item" href="../../../cpp/stl/">STL</a></li>
</ul></li>
                    <li class="toctree-l1"><button class="section nav-item">System Design</button>
<ul class="subnav">
    <li class="toctree-l2"><a class="nav-item" href="../../../system-design/questions/1.%20url-shortener/">URL Shortener</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../system-design/questions/2.%20dropbox/">Dropbox</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../system-design/questions/3.%20local-delivery/">Local Delivery</a></li>
    <li class="toctree-l2">
<a class="nav-item" href="../../../system-design/questions/23.%20ad-click-aggregator/">Ad Click Aggregator</a></li>
    <li class="toctree-l2">
<a class="nav-item" href="../../../system-design/questions/12.%20live-comments/">Live Comments</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../system-design/questions/4.%20ticketmaster/">Ticketmaster</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../system-design/questions/6.%20tinder/">Tinder</a></li>
    <li class="toctree-l2">
<a class="nav-item" href="../../../system-design/questions/16.%20uber/">Uber</a></li>
    <li class="toctree-l2">
<a class="nav-item" href="../../../system-design/questions/8.%20whatsapp/">Whatsapp</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../system-design/questions/20.%20youtube/">YouTube</a></li>
    <li class="toctree-l2">
<a class="nav-item" href="../../../system-design/questions/15.%20youtube-top-k/">YouTube Top K</a></li>
</ul></li>
                    <li class="toctree-l1"><button class="section nav-item">MySQL</button>
<ul class="subnav">
    <li class="toctree-l2"><a class="nav-item" href="../1.%20acid/">ACID</a></li>
    <li class="toctree-l2 current"><a class="nav-item current" href="./">Database Internals</a><a class="nav-item current" href="./">Database Internals</a><a class="nav-item current" href="./">Database Internals</a><a class="nav-item current" href="./">Database Internals</a><a class="nav-item current" href="./">Database Internals</a><a class="nav-item current" href="./">Database Internals</a>
<ul class="subnav">
<li class="toctree-l3"><a class="nav-item toc" href="#row-based-databases-eg-mysql-postgresql">Row-Based Databases (e.g., MySQL, PostgreSQL)</a></li>
<li class="toctree-l3"><a class="nav-item toc" href="#column-based-databases-eg-bigquery-redshift-clickhouse">Column-Based Databases (e.g., BigQuery, Redshift, ClickHouse)</a></li>
<li class="toctree-l3"><a class="nav-item toc" href="#primary-key-clustered-index">Primary Key (Clustered Index)</a></li>
<li class="toctree-l3"><a class="nav-item toc" href="#secondary-key-secondary-index">Secondary Key (Secondary Index)</a></li>
</ul></li>
    <li class="toctree-l2"><a class="nav-item" href="../3.%20locks/">Lock</a><a class="nav-item" href="../3.%20locks/">Lock</a><a class="nav-item" href="../3.%20locks/">Lock</a><a class="nav-item" href="../3.%20locks/">Lock</a><a class="nav-item" href="../3.%20locks/">Lock</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../4.%20indexes/">Index</a><a class="nav-item" href="../4.%20indexes/">Index</a><a class="nav-item" href="../4.%20indexes/">Index</a><a class="nav-item" href="../4.%20indexes/">Index</a><a class="nav-item" href="../4.%20indexes/">Index</a><a class="nav-item" href="../4.%20indexes/">Index</a><a class="nav-item" href="../4.%20indexes/">Index</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../5.%20b-tree/">B Tree</a><a class="nav-item" href="../5.%20b-tree/">B Tree</a><a class="nav-item" href="../5.%20b-tree/">B Tree</a><a class="nav-item" href="../5.%20b-tree/">B Tree</a><a class="nav-item" href="../5.%20b-tree/">B Tree</a><a class="nav-item" href="../5.%20b-tree/">B Tree</a><a class="nav-item" href="../5.%20b-tree/">B Tree</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../6.%20partitioning/">Partitioning</a><a class="nav-item" href="../6.%20partitioning/">Partitioning</a><a class="nav-item" href="../6.%20partitioning/">Partitioning</a><a class="nav-item" href="../6.%20partitioning/">Partitioning</a><a class="nav-item" href="../6.%20partitioning/">Partitioning</a><a class="nav-item" href="../6.%20partitioning/">Partitioning</a><a class="nav-item" href="../6.%20partitioning/">Partitioning</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../7.%20sharding/">Sharding</a><a class="nav-item" href="../7.%20sharding/">Sharding</a><a class="nav-item" href="../7.%20sharding/">Sharding</a><a class="nav-item" href="../7.%20sharding/">Sharding</a><a class="nav-item" href="../7.%20sharding/">Sharding</a><a class="nav-item" href="../7.%20sharding/">Sharding</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../8.%20concurrency-control/">Concurrency Control</a><a class="nav-item" href="../8.%20concurrency-control/">Concurrency Control</a><a class="nav-item" href="../8.%20concurrency-control/">Concurrency Control</a><a class="nav-item" href="../8.%20concurrency-control/">Concurrency Control</a><a class="nav-item" href="../8.%20concurrency-control/">Concurrency Control</a><a class="nav-item" href="../8.%20concurrency-control/">Concurrency Control</a><a class="nav-item" href="../8.%20concurrency-control/">Concurrency Control</a><a class="nav-item" href="../8.%20concurrency-control/">Concurrency Control</a><a class="nav-item" href="../8.%20concurrency-control/">Concurrency Control</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../9.%20replication/">Replication</a><a class="nav-item" href="../9.%20replication/">Replication</a><a class="nav-item" href="../9.%20replication/">Replication</a><a class="nav-item" href="../9.%20replication/">Replication</a><a class="nav-item" href="../9.%20replication/">Replication</a><a class="nav-item" href="../9.%20replication/">Replication</a><a class="nav-item" href="../9.%20replication/">Replication</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../10.%20engines/">Engines</a><a class="nav-item" href="../10.%20engines/">Engines</a><a class="nav-item" href="../10.%20engines/">Engines</a><a class="nav-item" href="../10.%20engines/">Engines</a><a class="nav-item" href="../10.%20engines/">Engines</a><a class="nav-item" href="../10.%20engines/">Engines</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../11.%20cursors/">Cursors</a><a class="nav-item" href="../11.%20cursors/">Cursors</a><a class="nav-item" href="../11.%20cursors/">Cursors</a><a class="nav-item" href="../11.%20cursors/">Cursors</a><a class="nav-item" href="../11.%20cursors/">Cursors</a><a class="nav-item" href="../11.%20cursors/">Cursors</a><a class="nav-item" href="../11.%20cursors/">Cursors</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../12.%20mvcc/">MVCC</a><a class="nav-item" href="../12.%20mvcc/">MVCC</a><a class="nav-item" href="../12.%20mvcc/">MVCC</a><a class="nav-item" href="../12.%20mvcc/">MVCC</a><a class="nav-item" href="../12.%20mvcc/">MVCC</a><a class="nav-item" href="../12.%20mvcc/">MVCC</a><a class="nav-item" href="../12.%20mvcc/">MVCC</a></li>
</ul></li>
                    <li class="toctree-l1"><button class="section nav-item">Kafka</button>
<ul class="subnav">
    <li class="toctree-l2"><a class="nav-item" href="../../../kafka/1.%20architecture/">Architecture</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../kafka/2.%20partitions%20and%20data%20distributions/">Partitions and Data Distributions</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../kafka/3.%20producers/">Producers</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../kafka/4.%20consumers/">Consumers</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../kafka/5.%20message%20delivery%20semantics/">Message Delivery Semantics</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../kafka/6.%20performance%20and%20tuning/">Performance and Tuning</a></li>
    <li class="toctree-l2"><a class="nav-item" href="../../../kafka/7.%20kafka%20streams/">Streams</a></li>
</ul></li>
                    <li class="toctree-l1"><button class="section nav-item">Spark</button>
<ul class="subnav">
    <li class="toctree-l2"><a class="nav-item" href="../../../spark/spark/">Spark</a></li>
</ul></li>
                    <li class="toctree-l1"><button class="section nav-item">Object Oriented Programming</button>
<ul class="subnav">
    <li class="toctree-l2"><button class="section nav-item hide">Java</button>
<ul class="subnav hide">
    <li class="toctree-l3"><a class="nav-item" href="../../../oop/java/concepts/">Concepts</a></li>
    <li class="toctree-l3"><a class="nav-item" href="../../../oop/java/solid-principles/">Solid Principles</a></li>
    <li class="toctree-l3"><a class="nav-item" href="../../../oop/java/design-patterns/">Design Patterns</a></li>
</ul></li>
    <li class="toctree-l2"><button class="section nav-item hide">C++</button>
<ul class="subnav hide">
    <li class="toctree-l3"><a class="nav-item" href="../../../oop/cpp/concepts/">Concepts</a></li>
    <li class="toctree-l3"><a class="nav-item" href="../../../oop/cpp/solid-principles/">Solid Principles</a></li>
    <li class="toctree-l3"><a class="nav-item" href="../../../oop/cpp/design-patterns/">Design Patterns</a></li>
</ul></li>
</ul></li>
                </ul>
            </nav>
            <div class="repo">
    <div class="link">
        <a href="https://github.com/RafsanMazumder/notes" class="fa fa-github"> GitHub</a>
    </div>
    <div class="previous"><a href="../1.%20acid/">&laquo; Previous</a></div>
    <div class="next"><a href="../3.%20locks/">Next &raquo;</a></div>
</div>
        </aside>
        <div id="spacer"><button class="arrow"></button></div>
        <main>
            <div class="home-top">
                <button class="hamburger"></button>
                <a href="../../.." class="site-name"> Software Engineering Notes</a>
            </div>
            <div id="main">
                <nav class="breadcrumbs">
<ul>
    <li>MySQL</li>
</ul>
</nav>
                <div id="content"><p>Of course. These are excellent topics that go to the heart of how a database engine like InnoDB operates. Understanding
them demonstrates a solid grasp of database fundamentals beyond just writing SQL queries.</p>
<p>Here are detailed, interview-ready notes on each topic.</p>
<hr />
<h3 id="comprehensive-interview-notes-mysql-database-internals"><strong>Comprehensive Interview Notes: MySQL Database Internals</strong></h3>
<h3 id="1-how-tables-and-rows-are-stored-on-disk-mysql-innodb">🧱 1. How Tables and Rows Are Stored on Disk (MySQL – InnoDB)</h3>
<p>At a high level, InnoDB stores data in a hierarchy of structures, ultimately residing in files on disk. The key concept
to remember is that in InnoDB, a table is physically organized as a <strong>B+ Tree</strong> based on its <strong>Primary Key</strong>.</p>
<p><strong>The Hierarchy of Storage:</strong></p>
<ol>
<li>
<p><strong>Tablespace:</strong> This is the logical container for table data and indexes.</p>
<ul>
<li><strong>File-Per-Table (Default):</strong> The recommended setup where each InnoDB table and its indexes are stored in their
  own file with an <code>.ibd</code> extension (e.g., <code>employees.ibd</code>). This makes management (like backup or restoring a
  single table) much easier.</li>
<li><strong>System Tablespace (<code>ibdata1</code>):</strong> An older method where multiple tables and their indexes, along with other
  system data (like the undo log), are stored in a shared file.</li>
</ul>
</li>
<li>
<p><strong>Segment:</strong> Within a tablespace, InnoDB allocates space for data in Segments. A typical table has at least two
   segments:</p>
<ul>
<li><strong>Clustered Index Segment:</strong> Holds the actual table data (the primary key's B+ Tree).</li>
<li><strong>Secondary Index Segments:</strong> Each secondary index has its own segment.</li>
</ul>
</li>
<li>
<p><strong>Extent:</strong> A segment is made up of Extents. An extent is a contiguous block of <strong>64 pages</strong>, totaling 1MB (64 *
   16KB). This is done to efficiently allocate larger chunks of space.</p>
</li>
<li>
<p><strong>Page:</strong> The <strong>Page</strong> is the fundamental unit of I/O in InnoDB. This is the smallest amount of data that is read
   from or written to disk. (More on this in section 4).</p>
</li>
</ol>
<p><strong>The Clustered Index: The Core Concept</strong></p>
<ul>
<li>In InnoDB, the table data is <strong>not</strong> stored as a simple heap of rows. Instead, it is physically structured as a <strong>B+
  Tree</strong> index, sorted by the <strong>Primary Key</strong>. This is called the <strong>Clustered Index</strong>.</li>
<li>The <strong>leaf nodes</strong> of this B+ Tree contain the <strong>full row data</strong>.</li>
<li>This means that looking up a row by its Primary Key is extremely fast, as you are directly traversing the tree that
  <em>is</em> the table.</li>
</ul>
<p><strong>Visual Flow:</strong></p>
<pre><code>Disk File (`mytable.ibd`)
 |
 +--&gt; Tablespace
       |
       +--&gt; Clustered Index Segment (The B+ Tree)
             |
             +--&gt; Extents (Groups of 64 pages)
                   |
                   +--&gt; Pages (16KB blocks, the fundamental unit)
                         |
                         +--&gt; Rows of data, physically sorted by Primary Key
</code></pre>
<p><strong>Key Takeaway:</strong> In InnoDB, the Primary Key is not just an identifier; it dictates the <strong>physical storage order</strong> of
the data on disk. Choosing a good Primary Key is critical for performance.</p>
<hr />
<h3 id="2-row-based-vs-column-based-databases">🆚 2. Row-Based vs. Column-Based Databases</h3>
<p>This distinction defines how data is physically laid out on disk, which has massive performance implications for
different types of workloads.</p>
<h4 id="row-based-databases-eg-mysql-postgresql"><strong>Row-Based Databases (e.g., MySQL, PostgreSQL)</strong></h4>
<ul>
<li><strong>How it works:</strong> Data for a single row is stored contiguously on disk.</li>
<li><strong>Storage Layout:</strong> <code>[Row1_ColA, Row1_ColB, Row1_ColC], [Row2_ColA, Row2_ColB, Row2_ColC], ...</code></li>
<li><strong>Best for:</strong> <strong>OLTP (Online Transaction Processing)</strong> workloads. These involve reading or writing full rows of data
  for specific transactions.<ul>
<li><code>SELECT * FROM users WHERE user_id = 123;</code></li>
<li><code>UPDATE products SET price = 99, stock = 50 WHERE product_id = 456;</code></li>
</ul>
</li>
<li><strong>Advantages:</strong><ul>
<li><strong>Fast full-row operations:</strong> Reading or writing an entire row is efficient because all the data is located
  together.</li>
</ul>
</li>
<li><strong>Disadvantages:</strong><ul>
<li><strong>Slow aggregate queries:</strong> A query like <code>SELECT SUM(price) FROM sales;</code> is inefficient. The database must read
  every single column of every row from disk, even though it only needs the <code>price</code> column.</li>
</ul>
</li>
</ul>
<h4 id="column-based-databases-eg-bigquery-redshift-clickhouse"><strong>Column-Based Databases (e.g., BigQuery, Redshift, ClickHouse)</strong></h4>
<ul>
<li><strong>How it works:</strong> Data for a single column is stored contiguously on disk.</li>
<li><strong>Storage Layout:</strong> <code>[Row1_ColA, Row2_ColA, ...], [Row1_ColB, Row2_ColB, ...], [Row1_ColC, Row2_ColC, ...]</code></li>
<li><strong>Best for:</strong> <strong>OLAP (Online Analytical Processing)</strong> workloads. These involve aggregations and analysis over a huge
  number of rows but only a few columns.<ul>
<li><code>SELECT SUM(sales_amount) FROM transactions WHERE YEAR(transaction_date) = 2023;</code></li>
</ul>
</li>
<li><strong>Advantages:</strong><ul>
<li><strong>Extremely fast analytics:</strong> The database only needs to read the specific columns required for the query,
  dramatically reducing I/O.</li>
<li><strong>High compression:</strong> Data within a single column is often highly similar (e.g., a list of countries), making it
  very easy to compress.</li>
</ul>
</li>
<li><strong>Disadvantages:</strong><ul>
<li><strong>Slow full-row operations:</strong> Retrieving a full row is expensive, as it requires assembling data from multiple
  separate column files on disk.</li>
</ul>
</li>
</ul>
<hr />
<h3 id="3-primary-key-vs-secondary-key-in-innodb">🔑 3. Primary Key vs. Secondary Key (in InnoDB)</h3>
<p>This is a direct consequence of InnoDB's clustered index architecture.</p>
<h4 id="primary-key-clustered-index"><strong>Primary Key (Clustered Index)</strong></h4>
<ul>
<li><strong>Structure:</strong> It <em>is</em> the table. It's a B+ Tree where the leaf nodes contain the <strong>full data for each row</strong>.</li>
<li><strong>Uniqueness:</strong> Must be unique and non-null.</li>
<li><strong>Quantity:</strong> There can be <strong>only one</strong> primary key per table.</li>
<li><strong>Performance:</strong> Lookups are extremely fast because once you find the leaf node, you have all the data. No extra
  lookups are needed.</li>
</ul>
<h4 id="secondary-key-secondary-index"><strong>Secondary Key (Secondary Index)</strong></h4>
<ul>
<li><strong>Structure:</strong> It's a separate B+ Tree. Its leaf nodes contain the <strong>indexed column(s) value</strong> and a <strong>pointer</strong> to
  the <strong>Primary Key</strong> of the corresponding row.</li>
<li><strong>Uniqueness:</strong> Can be unique or non-unique.</li>
<li><strong>Quantity:</strong> You can have many secondary keys per table.</li>
<li><strong>Performance:</strong> A lookup using a secondary key is a <strong>two-step process</strong>:<ol>
<li><strong>Traverse the Secondary Index:</strong> The database walks the B+ Tree of the secondary index to find the entry
   matching your query. From the leaf node, it retrieves the <strong>Primary Key value</strong>.</li>
<li><strong>Traverse the Primary Index:</strong> The database then uses that Primary Key value to traverse the Clustered Index (
   the main table) to find the leaf node containing the <strong>full row data</strong>.</li>
</ol>
</li>
</ul>
<p><strong>Visualizing the Two-Step Lookup:</strong></p>
<pre><code>// Query: SELECT * FROM employees WHERE last_name = 'Jones';

// Step 1: Search the Secondary Index on `last_name`
Secondary Index B+ Tree (`idx_lastname`)
   Leaf Node: ['Jones', PrimaryKey_Value: 101]
                  ^
                  |  (This PK value is retrieved)
                  |
// Step 2: Use the PK to search the Primary Index (the table itself)
                  |
                  v
Primary Index B+ Tree (`PRIMARY`)
   Leaf Node: [101, 'David', 'Jones', 'd.jones@email.com', ...]
              ^----------------------------------------------^
                    (This full row data is returned)
</code></pre>
<p><strong>Key Takeaway:</strong> Secondary index lookups can be slower than primary key lookups because they may require two B-Tree
traversals. This is why having a <code>covering index</code> (where all columns needed for the query are in the secondary index
itself) is a major performance optimization.</p>
<hr />
<h3 id="4-database-pages-innodb">📄 4. Database Pages (InnoDB)</h3>
<p>The <strong>Page</strong> (or Block) is the atomic unit of I/O and memory management for InnoDB.</p>
<ul>
<li><strong>Size:</strong> A fixed size, <strong>16KB by default</strong>.</li>
<li><strong>Atomicity:</strong> InnoDB reads and writes data to/from disk in whole pages, never partial pages.</li>
<li><strong>Buffer Pool:</strong> When data is needed, InnoDB fetches the entire page from disk and loads it into an in-memory cache
  called the <strong>Buffer Pool</strong>. All modifications (<code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>) happen to the page <em>in memory</em>, which is
  much faster than writing to disk directly. The modified ("dirty") page is then flushed to disk later by a background
  process.</li>
<li><strong>Structure of a Page:</strong> A page isn't just raw data. It has a well-defined structure:<ul>
<li><strong>Page Header:</strong> Contains metadata like the page number, pointers to previous/next pages (forming a doubly-linked
  list at the leaf level), and checksums.</li>
<li><strong>Row Data:</strong> The actual rows are stored here, filling up from the bottom.</li>
<li><strong>Page Directory:</strong> A "slot" directory that helps find rows on the page quickly without scanning the whole page.</li>
<li><strong>Free Space:</strong> Unallocated space for new or updated rows.</li>
</ul>
</li>
</ul>
<hr />
<h3 id="5-redo-log-vs-undo-log">🔄 5. Redo Log vs. Undo Log</h3>
<p>These two logs are the heart of InnoDB's ability to provide <strong>ACID</strong> properties. They are often confused but serve
completely opposite purposes.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Feature</th>
<th style="text-align: left;">🔴 Redo Log</th>
<th style="text-align: left;">🔵 Undo Log</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Purpose</strong></td>
<td style="text-align: left;">To ensure <strong>Durability</strong> and aid in <strong>Crash Recovery</strong>.</td>
<td style="text-align: left;">To ensure <strong>Atomicity</strong> (rollback) and <strong>Isolation</strong> (MVCC).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>What it Stores</strong></td>
<td style="text-align: left;">The <strong>"after image"</strong> of data. Records the <em>change</em> that was made (e.g., "change value in page X at offset Y from A to B").</td>
<td style="text-align: left;">The <strong>"before image"</strong> of data. Records the <em>original</em> data before it was modified (e.g., "the value used to be A").</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Analogy</strong></td>
<td style="text-align: left;">A <strong>recipe to replay</strong> a committed transaction.</td>
<td style="text-align: left;">A <strong>recipe to reverse</strong> an uncommitted transaction.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>When it's Written</strong></td>
<td style="text-align: left;"><strong>Before</strong> the data page in memory is modified. This is part of the <strong>Write-Ahead Logging (WAL)</strong> protocol.</td>
<td style="text-align: left;"><strong>Before</strong> the data page in memory is modified.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>How it's Used</strong></td>
<td style="text-align: left;"><strong>On Crash Recovery:</strong> InnoDB replays the redo log to re-apply any changes from committed transactions that hadn't yet been flushed from the buffer pool to disk.</td>
<td style="text-align: left;"><strong>On <code>ROLLBACK</code>:</strong> The undo log is read to restore the original row versions.<br/><strong>On <code>SELECT</code> (MVCC):</strong> Used to construct old versions of a row for transactions that need a consistent read.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Lifecycle</strong></td>
<td style="text-align: left;">It's a circular buffer. Space is reused once the corresponding dirty pages have been flushed to disk.</td>
<td style="text-align: left;">Purged by a background thread only when no active transaction still needs the old versions for its consistent read snapshot.</td>
</tr>
</tbody>
</table>
<p><strong>The Combined Workflow of an <code>UPDATE</code>:</strong></p>
<ol>
<li><strong>Transaction Starts:</strong> <code>START TRANSACTION;</code></li>
<li><strong><code>UPDATE</code> is issued:</strong> <code>UPDATE employees SET salary = 90000 WHERE id = 1;</code></li>
<li><strong>Undo Log Write:</strong> InnoDB writes the <em>original</em> row (<code>{id: 1, salary: 80000}</code>) to the <strong>Undo Log</strong>.</li>
<li><strong>Redo Log Write:</strong> InnoDB writes the <em>change</em> (<code>change salary to 90000 for row X</code>) to the <strong>Redo Log</strong>.</li>
<li><strong>Memory Change:</strong> The page containing the row in the <strong>Buffer Pool</strong> is modified to <code>90000</code>.</li>
<li><strong><code>COMMIT</code> is issued:</strong><ul>
<li>The <strong>Redo Log is flushed to disk</strong>. This is a fast, sequential write. Once this is done, the transaction is
  considered durable and the commit returns success.</li>
<li>The modified data page in the Buffer Pool is now "dirty" and will be flushed to disk later at an optimal time.</li>
</ul>
</li>
<li><strong>If MySQL crashes before the data page is flushed:</strong> On restart, it will see the commit in the Redo Log and replay
   the change, guaranteeing durability.</li>
</ol></div>
                <footer>
    <div class="footer-buttons">
        <div class="previous"><a href="../1.%20acid/" title="ACID"><span>Previous</span></a></div>
        <div class="next"><a href="../3.%20locks/" title="Lock"><span>Next</span></a></div>
    </div>
    <div class="footer-note">
        <p>
            Built with <a href="http://www.mkdocs.org">MkDocs</a> using
            <a href="https://github.com/daizutabi/mkdocs-ivory">Ivory theme</a>.
        </p>
    </div>
</footer>
            </div>
        </main>
    </div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme.js"></script>
    <script src="../../../search/main.js"></script>
</body>

</html>